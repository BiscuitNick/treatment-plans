{
  "master": {
    "tasks": [
      {
        "id": "56",
        "title": "Set Up Comprehensive Testing Infrastructure",
        "description": "Configure the development environment with React Testing Library for component tests and Playwright for E2E tests, supplementing the existing Jest setup.",
        "details": "1. Install dev dependencies: `@testing-library/react`, `@testing-library/jest-dom`, `@testing-library/user-event`, `@playwright/test`, `jest-environment-jsdom`. \n2. Update `jest.config.ts` and `jest.setup.ts` to support React component testing (jsdom environment). \n3. Initialize Playwright configuration (`playwright.config.ts`) for E2E testing. \n4. Create test utilities in `test/utils.tsx` (custom render with providers) and `test/mocks` (Prisma, Auth, AI SDK mocks). \n5. Update `package.json` scripts: `test:unit`, `test:component`, `test:e2e`, `test:coverage`.",
        "testStrategy": "Verify all `npm run test:*` scripts execute without configuration errors. Ensure a simple dummy test passes in each suite.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:31:03.547Z"
      },
      {
        "id": "57",
        "title": "Unit Tests - Schemas and Utilities",
        "description": "Implement unit tests for Zod schemas and shared utility functions to ensure data validation logic is correct.",
        "details": "Create test files for:\n1. `lib/schemas/plan.ts` (TreatmentPlanSchema, DiagnosisSchema, ClinicalGoalSchema).\n2. `lib/schemas/suggestion.ts` (Suggestion schemas).\n3. `lib/utils.ts` (Helper functions).\n4. `lib/auth.ts` (Auth configuration and callbacks).\n\nFocus on validating strictly valid inputs, edge case invalid inputs, and optional fields.",
        "testStrategy": "Run `npm run test:unit` targeting these specific files. Aim for 100% branch coverage on schemas.",
        "priority": "medium",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:32:39.372Z"
      },
      {
        "id": "58",
        "title": "Unit Tests - Core Services (Safety & Analysis)",
        "description": "Add comprehensive unit tests for the critical safety and analysis business logic services.",
        "details": "Create test files for:\n1. `services/safety.ts`: Test `scanForKeywords`, `analyzeRiskWithLLM`, and `validateContent`. Mock LLM responses.\n2. `services/analysis.ts`: Test session analysis transformation logic.\n\nEnsure sensitive keywords (harm, abuse) trigger correct flags and AI errors are handled gracefully.",
        "testStrategy": "Run `npm run test:unit`. Mock external AI calls using `jest.mock`. Verify risk detection logic with various input samples.",
        "priority": "high",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:35:06.887Z"
      },
      {
        "id": "59",
        "title": "Unit Tests - Suggestion Services",
        "description": "Implement unit tests for prompt generation and suggestion services.",
        "details": "Create test files for:\n1. `services/prompt-service.ts`: Verify prompt assembly.\n2. `services/suggestion-service.ts`: Test suggestion generation workflow.\n3. `services/suggestion-prompt.ts`: Test template variable substitution.\n\nValidate that prompts are constructed correctly based on session data inputs.",
        "testStrategy": "Run `npm run test:unit`. Verify template string interpolation and mock OpenAI calls.",
        "priority": "medium",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:35:06.912Z"
      },
      {
        "id": "60",
        "title": "Unit Tests - Server Actions (Session & Patient)",
        "description": "Test server-side actions responsible for Session and Patient CRUD operations.",
        "details": "Create test files for:\n1. `app/actions/sessions.ts`: Fetching, suggestions.\n2. `app/actions/patients.ts`: Patient CRUD.\n\nMock `lib/db` (Prisma) and `lib/auth`. Verify Zod validation, authorization checks (user ownership), and database transaction success/failure paths.",
        "testStrategy": "Run `npm run test:unit`. Ensure authorized users can perform actions and unauthorized ones cannot.",
        "priority": "high",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.086Z"
      },
      {
        "id": "61",
        "title": "Unit Tests - Server Actions (Plan, Audio, Settings)",
        "description": "Test remaining server actions covering Plans, Audio, Settings, and Demo generation.",
        "details": "Create test files for:\n1. `app/actions/audio.ts` (URL generation).\n2. `app/actions/settings.ts` (Preferences).\n3. `app/actions/plan-history.ts` (Versioning).\n4. `app/actions/generateDemoSession.ts`.\n\nVerify edge cases like null values and empty results.",
        "testStrategy": "Run `npm run test:unit`. Mock S3 signed URL generation and database calls.",
        "priority": "medium",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.086Z"
      },
      {
        "id": "62",
        "title": "Unit Tests - API Routes (Session Management)",
        "description": "Implement tests for all session-related API endpoints.",
        "details": "Create tests for:\n1. `POST /api/sessions`\n2. `GET /api/sessions`\n3. `POST /api/sessions/[id]`\n4. `POST /api/sessions/[id]/transcribe`\n5. `GET /api/sessions/[id]/audio-url`\n6. `POST /api/sessions/[id]/analyze`\n7. `POST /api/sessions/[id]/summary`\n\nUse `node-mocks-http` or similar to mock NextRequest/NextResponse if needed, or test handler logic directly if separated.",
        "testStrategy": "Run `npm run test:unit`. Cover happy paths, auth failures, and validation errors. Achieve 90%+ coverage.",
        "priority": "high",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.087Z"
      },
      {
        "id": "63",
        "title": "Unit Tests - API Routes (Treatment Plans)",
        "description": "Implement tests for treatment plan API endpoints including versioning and diffing.",
        "details": "Create tests for:\n1. `POST /api/plans`\n2. `GET /api/plans/[id]`\n3. `POST /api/plans/[id]/update`\n4. `GET /api/plans/[id]/diff`\n5. `GET /api/plans/[id]/versions/[versionId]`\n6. `GET /api/plans/[id]/goal-history`\n\nVerify version incrementing logic and diff calculation accuracy.",
        "testStrategy": "Run `npm run test:unit`. Ensure unauthorized access returns 401/403.",
        "priority": "high",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.087Z"
      },
      {
        "id": "64",
        "title": "Unit Tests - API Routes (Suggestions & Dashboard)",
        "description": "Test endpoints for suggestion workflow, core analysis, and dashboard data.",
        "details": "Create tests for:\n1. `POST /api/suggestions/[id]/approve`\n2. `POST /api/suggestions/[id]/reject`\n3. `POST /api/analyze`\n4. `POST /api/upload-url`\n5. `GET /api/dashboard/reviews-due`\n\nTest state transitions for suggestions and date calculation logic for dashboard reviews.",
        "testStrategy": "Run `npm run test:unit`. Mock S3 upload URL generation and AI analysis pipeline.",
        "priority": "medium",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.088Z"
      },
      {
        "id": "65",
        "title": "Component Tests - Session Management UI",
        "description": "Add React Testing Library tests for session pages and modals.",
        "details": "Create tests for:\n1. `sessions-page-client.tsx`\n2. `add-session-modal.tsx`\n3. `transcript-modal.tsx`\n4. `audio-player-modal.tsx`\n5. `sessions-table.tsx`\n6. `file-drop-zone.tsx`\n\nSimulate user events (clicks, typing) and verify DOM updates. Test loading and error states.",
        "testStrategy": "Run `npm run test:component`. Verify accessibility roles and proper rendering of session lists.",
        "priority": "medium",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.088Z"
      },
      {
        "id": "66",
        "title": "Component Tests - Plan Editor & Views",
        "description": "Add component tests for the complex Plan Editor and its sub-views.",
        "details": "Create tests for:\n1. `PlanEditor.tsx`\n2. `DualViewPlan.tsx`\n3. `ClientView.tsx`\n4. `TherapistView.tsx`\n5. `SuggestionReviewPanel.tsx`\n\nFocus on form interactions, view switching (Therapist vs Client), and suggestion acceptance flows.",
        "testStrategy": "Run `npm run test:component`. Ensure form validation triggers correctly on submit attempts.",
        "priority": "high",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.089Z"
      },
      {
        "id": "67",
        "title": "Component Tests - Patient & Dashboard UI",
        "description": "Add component tests for patient profiles and dashboard widgets.",
        "details": "Create tests for:\n1. `patient-header.tsx`\n2. `session-history.tsx`\n3. `add-patient-button.tsx`\n4. `dashboard-client-page.tsx`\n5. `session-list.tsx`\n6. `reviews-due-widget.tsx`\n\nTest navigation links and empty states.",
        "testStrategy": "Run `npm run test:component`. Verify data is displayed correctly based on props.",
        "priority": "medium",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.089Z"
      },
      {
        "id": "68",
        "title": "E2E Tests - Auth & Dashboard Navigation",
        "description": "Implement Playwright tests for authentication flows and general app navigation.",
        "details": "Create `e2e/auth.spec.ts` and `e2e/navigation.spec.ts` covering:\n1. Login via Cognito (mocked or test user).\n2. Session persistence.\n3. Logout.\n4. Protected route redirection.\n5. Dashboard loading and basic responsiveness.",
        "testStrategy": "Run `npm run test:e2e`. Ensure tests pass in a headless browser environment.",
        "priority": "high",
        "dependencies": [
          "56"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.090Z"
      },
      {
        "id": "69",
        "title": "E2E Tests - Session Workflow",
        "description": "Implement E2E tests for the complete session lifecycle.",
        "details": "Create `e2e/session.spec.ts` covering:\n1. Uploading audio to a new session.\n2. Assigning to patient.\n3. Triggering transcription/analysis.\n4. Reviewing suggestions.\n5. Deleting session.\n\nMock external S3/OpenAI calls at the network layer if possible to ensure stability.",
        "testStrategy": "Run `npm run test:e2e`. Verify the full flow from upload to analysis completion.",
        "priority": "high",
        "dependencies": [
          "68"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.090Z"
      },
      {
        "id": "70",
        "title": "E2E Tests - Patient & Treatment Plan Workflow",
        "description": "Implement E2E tests for managing patients and treatment plans.",
        "details": "Create `e2e/plans.spec.ts` and `e2e/patients.spec.ts` covering:\n1. Creating a new patient.\n2. Creating a treatment plan.\n3. Switching views (Therapist/Client).\n4. Creating a new plan version.\n5. Verifying diff history.\n6. Patient status updates.",
        "testStrategy": "Run `npm run test:e2e`. Verify data persistence and correct UI updates after mutations.",
        "priority": "medium",
        "dependencies": [
          "68"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.090Z"
      },
      {
        "id": "71",
        "title": "Documentation & CI Integration",
        "description": "Finalize testing documentation and integrate with CI pipeline.",
        "details": "1. Generate coverage report using `npm run test:coverage`.\n2. Create `TESTING.md` documenting patterns (mocks, file locations).\n3. Update main `README.md` with coverage badges.\n4. Create a GitHub Actions workflow (or relevant CI config) to run `test:unit`, `test:component`, and `test:e2e` on PRs.\n5. Enforce coverage thresholds in Jest config.",
        "testStrategy": "Trigger a dummy PR to verify CI pipeline runs all tests and reports status correctly.",
        "priority": "medium",
        "dependencies": [
          "56",
          "57",
          "58",
          "59",
          "60",
          "61",
          "62",
          "63",
          "64",
          "65",
          "66",
          "67",
          "68",
          "69",
          "70"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2025-12-04T18:39:51.091Z"
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-12-04T18:39:51.091Z",
      "taskCount": 16,
      "completedCount": 16,
      "tags": [
        "master"
      ]
    }
  }
}